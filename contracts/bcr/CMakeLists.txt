file(GLOB ABI_FILES "*.abi")
configure_file("${ABI_FILES}" "${CMAKE_CURRENT_BINARY_DIR}" COPYONLY)

set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_RSA)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_DH)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_CMS)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_EC2M)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_FP_API)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_BIO)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_ERR)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_LHASH)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_ENGINE)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_NO_EC_NISTP_64_GCC_128)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DOPENSSL_SMALL_FOOTPRINT)
set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS} -DBN_SQR_COMBA)

set(STANDARD_INCLUDE_FOLDERS
    ${STANDARD_INCLUDE_FOLDERS}
    ${CMAKE_CURRENT_SOURCE_DIR}/
    ${CMAKE_CURRENT_SOURCE_DIR}/ccgost
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl)

FILE(GLOB SOURCES
    ${CMAKE_CURRENT_SOURCE_DIR}/verify_gost_sign.c
    ${CMAKE_CURRENT_SOURCE_DIR}/ccgost/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/bn/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/buffer/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/dsa/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/ec/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/err/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/lhash/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/openssl/stack/*.c
)

add_wast_library(TARGET gost_verify_sign
  SOURCE_FILES ${SOURCES}
  INCLUDE_FOLDERS "${STANDARD_INCLUDE_FOLDERS}"
  LIBRARIES libc eosiolib
  DESTINATION_FOLDER ${CMAKE_CURRENT_BINARY_DIR}
)

add_wast_executable(TARGET bcr
  INCLUDE_FOLDERS "${STANDARD_INCLUDE_FOLDERS}"
  LIBRARIES gost_verify_sign libc++ libc eosiolib
  DESTINATION_FOLDER ${CMAKE_CURRENT_BINARY_DIR}
)
